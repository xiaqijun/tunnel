# 🚀 使用预编译版本快速部署

## ⚡ 最快部署方式（免编译）

### 方法一：一条命令完成（推荐）⭐

SSH 连接到服务器 **47.243.104.165** 后，执行：

```bash
bash <(wget -qO- https://raw.githubusercontent.com/xiaqijun/tunnel/main/deploy/quick-install.sh)
```

**仅需 30 秒！** 自动完成：
- ✅ 下载预编译的二进制文件
- ✅ 安装到 /opt/tunnel
- ✅ 配置 systemd 服务
- ✅ 配置防火墙
- ✅ 启动服务

---

### 方法二：分步安装（更可控）

#### 步骤 1：连接服务器

```bash
ssh root@47.243.104.165
```

#### 步骤 2：下载并安装

```bash
# 下载安装脚本
wget https://raw.githubusercontent.com/xiaqijun/tunnel/main/deploy/install-from-release.sh

# 执行安装
bash install-from-release.sh
```

#### 步骤 3：配置防火墙

```bash
# Ubuntu/Debian
ufw allow 7000/tcp
ufw allow 8080/tcp

# CentOS/RHEL
firewall-cmd --permanent --add-port=7000/tcp
firewall-cmd --permanent --add-port=8080/tcp
firewall-cmd --reload
```

#### 步骤 4：启动服务

```bash
systemctl start tunnel-server
systemctl enable tunnel-server
systemctl status tunnel-server
```

---

## 📦 手动安装（完全自定义）

如果您想完全控制安装过程：

### 1. 下载预编译二进制

访问 Release 页面选择版本：
https://github.com/xiaqijun/tunnel/releases

或使用命令下载最新版本：

```bash
# 根据系统架构选择
# AMD64 (x86_64)
wget https://github.com/xiaqijun/tunnel/releases/download/latest/tunnel-linux-amd64.tar.gz

# ARM64
wget https://github.com/xiaqijun/tunnel/releases/download/latest/tunnel-linux-arm64.tar.gz
```

### 2. 解压并安装

```bash
# 解压
tar -xzf tunnel-linux-amd64.tar.gz

# 创建安装目录
mkdir -p /opt/tunnel/bin

# 复制文件
cp tunnel-server-linux-amd64 /opt/tunnel/bin/tunnel-server
cp tunnel-client-linux-amd64 /opt/tunnel/bin/tunnel-client

# 设置权限
chmod +x /opt/tunnel/bin/*
```

### 3. 下载配置文件

```bash
cd /opt/tunnel

# 下载配置
wget https://raw.githubusercontent.com/xiaqijun/tunnel/main/config.yaml
wget https://raw.githubusercontent.com/xiaqijun/tunnel/main/client-config.yaml

# 生成随机 Token
RANDOM_TOKEN=$(openssl rand -base64 32 | tr -d "=+/" | cut -c1-32)
sed -i "s/token:.*/token: \"$RANDOM_TOKEN\"/" config.yaml

echo "您的 Token: $RANDOM_TOKEN"
```

### 4. 下载 Web 界面

```bash
mkdir -p /opt/tunnel/web
cd /opt/tunnel/web

wget https://raw.githubusercontent.com/xiaqijun/tunnel/main/web/index.html
wget https://raw.githubusercontent.com/xiaqijun/tunnel/main/web/app.js
wget https://raw.githubusercontent.com/xiaqijun/tunnel/main/web/style.css
```

### 5. 创建 systemd 服务

```bash
cat > /etc/systemd/system/tunnel-server.service << 'EOF'
[Unit]
Description=Tunnel Server
After=network.target

[Service]
Type=simple
User=root
WorkingDirectory=/opt/tunnel
ExecStart=/opt/tunnel/bin/tunnel-server -config /opt/tunnel/config.yaml
Restart=always
RestartSec=5

[Install]
WantedBy=multi-user.target
EOF

# 重载并启动
systemctl daemon-reload
systemctl start tunnel-server
systemctl enable tunnel-server
```

---

## 🆚 对比：预编译 vs 源码编译

| 特性 | 预编译版本 | 源码编译 |
|------|-----------|----------|
| 安装速度 | ⚡ 30秒 | 🐌 5-10分钟 |
| 需要 Go 环境 | ❌ 不需要 | ✅ 需要安装 |
| 磁盘占用 | 📦 ~20MB | 📦 ~500MB (含Go) |
| 网络要求 | 🌐 下载 ~10MB | 🌐 下载 ~300MB |
| 适用场景 | 生产环境 | 开发/定制 |

**推荐：** 生产环境使用预编译版本！

---

## 🌐 访问服务

部署完成后：

### Web 管理界面
```
http://47.243.104.165:8080
```

### API 端点
```
ws://47.243.104.165:7000
```

---

## 💻 客户端配置

在本地 Windows 机器上：

### 1. 下载客户端

访问：https://github.com/xiaqijun/tunnel/releases/latest

下载：`tunnel-windows-amd64.zip`

### 2. 配置文件

编辑 `client-config.yaml`：

```yaml
server:
  addr: "47.243.104.165:7000"
  token: "YOUR-TOKEN-FROM-SERVER"  # 从服务器获取

client:
  name: "my-pc"

tunnels:
  - name: "local-web"
    local_addr: "127.0.0.1"
    local_port: 8080      # 本地服务
    remote_port: 8000     # 映射到服务器的端口
```

### 3. 运行客户端

```cmd
tunnel-client-windows-amd64.exe -config client-config.yaml
```

### 4. 访问

访问 `http://47.243.104.165:8000` 即可访问本地 8080 端口的服务！

---

## 🔄 版本更新

### 更新到最新版本

```bash
# 停止服务
systemctl stop tunnel-server

# 重新运行安装脚本
bash <(wget -qO- https://raw.githubusercontent.com/xiaqijun/tunnel/main/deploy/install-from-release.sh)

# 启动服务
systemctl start tunnel-server
```

### 切换到特定版本

```bash
# 下载特定版本（例如 v1.0.0）
wget https://github.com/xiaqijun/tunnel/releases/download/v1.0.0/tunnel-linux-amd64.tar.gz

# 解压并替换
tar -xzf tunnel-linux-amd64.tar.gz
cp tunnel-server-linux-amd64 /opt/tunnel/bin/tunnel-server

# 重启服务
systemctl restart tunnel-server
```

---

## 📊 性能优势

使用预编译版本的优势：

- ⚡ **快速部署**：免去编译等待时间
- 💾 **节省资源**：无需安装 Go 及依赖
- 🎯 **可靠稳定**：经过 CI/CD 自动化测试
- 🔄 **易于更新**：直接替换二进制文件

---

## ✅ 验证安装

```bash
# 检查服务状态
systemctl status tunnel-server

# 查看日志
journalctl -u tunnel-server -f

# 检查端口
netstat -tlnp | grep -E '7000|8080'

# 测试连接
curl http://localhost:8080
```

---

## 🛠️ 管理命令

```bash
# 启动
systemctl start tunnel-server

# 停止
systemctl stop tunnel-server

# 重启
systemctl restart tunnel-server

# 状态
systemctl status tunnel-server

# 日志
journalctl -u tunnel-server -f

# 开机自启
systemctl enable tunnel-server
```

---

## 📖 其他文档

- [完整部署指南](INSTALL.md)
- [从源码编译](linux-deploy.sh)
- [Docker 部署](../DOCKER.md)
- [性能调优](../PERFORMANCE.md)

---

## 🎉 总结

**最推荐的部署方式：**

```bash
# 一条命令，30秒搞定！
ssh root@47.243.104.165
bash <(wget -qO- https://raw.githubusercontent.com/xiaqijun/tunnel/main/deploy/quick-install.sh)
```

简单、快速、可靠！🚀
