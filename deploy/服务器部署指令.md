# ä¸€é”®éƒ¨ç½²åˆ°æœåŠ¡å™¨ 47.243.104.165

## ğŸš€ æœ€å¿«éƒ¨ç½²æ–¹å¼ï¼ˆæ¨èï¼‰

### æ–¹æ³• 1ï¼šä¸€æ¡å‘½ä»¤å®Œæˆéƒ¨ç½²

SSH è¿æ¥åˆ°æœåŠ¡å™¨åï¼Œæ‰§è¡Œï¼š

```bash
bash <(curl -fsSL https://raw.githubusercontent.com/xiaqijun/tunnel/main/deploy/auto-deploy.sh)
```

æˆ–è€…å¦‚æœ GitHub è®¿é—®æ…¢ï¼š

```bash
bash <(wget -qO- https://raw.githubusercontent.com/xiaqijun/tunnel/main/deploy/auto-deploy.sh)
```

---

## ğŸ“‹ æ–¹æ³• 2ï¼šåˆ†æ­¥éƒ¨ç½²ï¼ˆæ›´å¯æ§ï¼‰

### è¿æ¥åˆ°æœåŠ¡å™¨

```bash
ssh root@47.243.104.165
```

### æ­¥éª¤ 1ï¼šå…‹éš†é¡¹ç›®

```bash
cd /opt
git clone https://github.com/xiaqijun/tunnel.git
cd tunnel
```

### æ­¥éª¤ 2ï¼šæ‰§è¡Œéƒ¨ç½²è„šæœ¬

```bash
chmod +x deploy/*.sh
bash deploy/linux-deploy.sh
```

### æ­¥éª¤ 3ï¼šä¿®æ”¹é…ç½®

```bash
nano config.yaml
```

**é‡è¦ï¼š** ä¿®æ”¹ `auth.token` ä¸ºå¼ºå¯†ç ï¼ˆè‡³å°‘ 20 ä½ï¼‰

### æ­¥éª¤ 4ï¼šé…ç½®é˜²ç«å¢™

```bash
sudo bash deploy/firewall-setup.sh
```

### æ­¥éª¤ 5ï¼šå®‰è£…å¹¶å¯åŠ¨æœåŠ¡

```bash
sudo bash deploy/install-service.sh
sudo systemctl start tunnel-server
sudo systemctl enable tunnel-server
```

### æ­¥éª¤ 6ï¼šæ£€æŸ¥çŠ¶æ€

```bash
sudo systemctl status tunnel-server
sudo journalctl -u tunnel-server -f
```

---

## ğŸ“‹ æ–¹æ³• 3ï¼šæ‰‹åŠ¨å‘½ä»¤ï¼ˆå®Œæ•´ç‰ˆï¼‰

å¦‚æœæ‚¨å–œæ¬¢æ›´ç»†è‡´çš„æ§åˆ¶ï¼Œå¯ä»¥é€æ¡æ‰§è¡Œï¼š

```bash
# 1. å®‰è£…å¿…è¦å·¥å…·ï¼ˆå¦‚æœæ²¡æœ‰ï¼‰
apt-get update
apt-get install -y git wget

# 2. å®‰è£… Goï¼ˆå¦‚æœæ²¡æœ‰ï¼‰
wget https://golang.org/dl/go1.21.6.linux-amd64.tar.gz
sudo rm -rf /usr/local/go
sudo tar -C /usr/local -xzf go1.21.6.linux-amd64.tar.gz
export PATH=$PATH:/usr/local/go/bin
echo 'export PATH=$PATH:/usr/local/go/bin' >> ~/.bashrc

# 3. å…‹éš†é¡¹ç›®
cd /opt
git clone https://github.com/xiaqijun/tunnel.git
cd tunnel

# 4. ç¼–è¯‘
mkdir -p bin
go build -ldflags="-s -w" -o bin/tunnel-server ./cmd/server
go build -ldflags="-s -w" -o bin/tunnel-client ./cmd/client
chmod +x bin/*

# 5. ä¿®æ”¹é…ç½®ï¼ˆç”Ÿæˆéšæœº tokenï¼‰
RANDOM_TOKEN=$(openssl rand -base64 32 | tr -d "=+/" | cut -c1-32)
sed -i "s/token:.*/token: \"$RANDOM_TOKEN\"/" config.yaml
echo "æ‚¨çš„ Token: $RANDOM_TOKEN"
echo "è¯·è®°å½•æ­¤ Tokenï¼"

# 6. é…ç½®é˜²ç«å¢™ï¼ˆUbuntu/Debianï¼‰
ufw allow 7000/tcp
ufw allow 8080/tcp

# æˆ–è€…ï¼ˆCentOS/RHELï¼‰
firewall-cmd --permanent --add-port=7000/tcp
firewall-cmd --permanent --add-port=8080/tcp
firewall-cmd --reload

# 7. å®‰è£… systemd æœåŠ¡
cp deploy/tunnel-server.service /etc/systemd/system/
systemctl daemon-reload

# 8. å¯åŠ¨æœåŠ¡
systemctl start tunnel-server
systemctl enable tunnel-server

# 9. æ£€æŸ¥çŠ¶æ€
systemctl status tunnel-server
```

---

## ğŸŒ è®¿é—®æœåŠ¡

éƒ¨ç½²å®Œæˆåï¼š

- **Web ç®¡ç†ç•Œé¢**ï¼šhttp://47.243.104.165:8080
- **éš§é“æœåŠ¡ç«¯å£**ï¼š47.243.104.165:7000

---

## ğŸ“± å®¢æˆ·ç«¯é…ç½®

åœ¨æœ¬åœ° Windows æœºå™¨ä¸Šï¼Œç¼–è¾‘ `client-config.yaml`ï¼š

```yaml
server:
  addr: "47.243.104.165:7000"
  token: "YOUR-TOKEN-FROM-SERVER"  # ä½¿ç”¨æœåŠ¡å™¨ç”Ÿæˆçš„ Token

client:
  name: "my-computer"
  reconnect_interval: 5
  heartbeat_interval: 30

tunnels:
  - name: "local-web"
    local_addr: "127.0.0.1"
    local_port: 8080      # æœ¬åœ°æœåŠ¡ç«¯å£
    remote_port: 8000     # æ˜ å°„åˆ°æœåŠ¡å™¨çš„ç«¯å£
```

ç„¶åè¿è¡Œå®¢æˆ·ç«¯ï¼š

```cmd
bin\tunnel-client.exe -config client-config.yaml
```

è®¿é—® `http://47.243.104.165:8000` å³å¯è®¿é—®æ‚¨æœ¬åœ°çš„ 8080 ç«¯å£æœåŠ¡ï¼

---

## ğŸ” éªŒè¯éƒ¨ç½²

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
systemctl status tunnel-server

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
journalctl -u tunnel-server -f

# æ£€æŸ¥ç«¯å£ç›‘å¬
netstat -tlnp | grep -E '7000|8080'

# æµ‹è¯• Web ç•Œé¢
curl http://localhost:8080
```

---

## ğŸ› ï¸ æœåŠ¡ç®¡ç†å‘½ä»¤

```bash
# å¯åŠ¨æœåŠ¡
systemctl start tunnel-server

# åœæ­¢æœåŠ¡
systemctl stop tunnel-server

# é‡å¯æœåŠ¡
systemctl restart tunnel-server

# æŸ¥çœ‹çŠ¶æ€
systemctl status tunnel-server

# æŸ¥çœ‹æ—¥å¿—
journalctl -u tunnel-server -f

# æŸ¥çœ‹æœ€è¿‘ 50 æ¡æ—¥å¿—
journalctl -u tunnel-server -n 50
```

---

## ğŸ” å®‰å…¨æé†’

1. **ä¿®æ”¹ Token**ï¼šéƒ¨ç½²ååŠ¡å¿…ä½¿ç”¨å¼ºéšæœºå¯†ç ä½œä¸º Token
2. **é…ç½®é˜²ç«å¢™**ï¼šç¡®ä¿åªå¼€æ”¾å¿…è¦çš„ç«¯å£
3. **å®šæœŸæ›´æ–°**ï¼šå®šæœŸ `git pull` è·å–æœ€æ–°ä»£ç 
4. **ç›‘æ§æ—¥å¿—**ï¼šå®šæœŸæ£€æŸ¥æœåŠ¡æ—¥å¿—

---

## â“ å¸¸è§é—®é¢˜

### 1. æ— æ³•è®¿é—® Web ç•Œé¢

```bash
# æ£€æŸ¥æœåŠ¡æ˜¯å¦è¿è¡Œ
systemctl status tunnel-server

# æ£€æŸ¥ç«¯å£æ˜¯å¦ç›‘å¬
netstat -tlnp | grep 8080

# æ£€æŸ¥é˜²ç«å¢™
iptables -L -n | grep 8080

# å¦‚æœä½¿ç”¨äº‘æœåŠ¡å™¨ï¼Œæ£€æŸ¥å®‰å…¨ç»„è§„åˆ™
# éœ€è¦åœ¨äº‘æ§åˆ¶å°å¼€æ”¾ 7000 å’Œ 8080 ç«¯å£
```

### 2. å®¢æˆ·ç«¯æ— æ³•è¿æ¥

- ç¡®è®¤æœåŠ¡å™¨ 7000 ç«¯å£å·²å¼€æ”¾
- ç¡®è®¤ Token é…ç½®æ­£ç¡®
- æ£€æŸ¥æœåŠ¡å™¨æ—¥å¿—ï¼š`journalctl -u tunnel-server -f`

### 3. ç¼–è¯‘å¤±è´¥

```bash
# æ£€æŸ¥ Go ç‰ˆæœ¬
go version  # éœ€è¦ 1.21+

# æ¸…ç†ç¼“å­˜é‡è¯•
go clean -cache
go build -ldflags="-s -w" -o bin/tunnel-server ./cmd/server
```

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

- æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£ï¼š[deploy/INSTALL.md](INSTALL.md)
- é¡¹ç›®ä»“åº“ï¼šhttps://github.com/xiaqijun/tunnel
